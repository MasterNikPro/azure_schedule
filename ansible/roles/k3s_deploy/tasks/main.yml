- name: install pip3
  apt: 
    update_cache: yes
    pkg: 
      - python3-pip 

    state: present

- name: install pre-requisites
  pip:
    name:
      - openshift
      - pyyaml
      - kubernetes 

- name: Create a k8s namespace
  kubernetes.core.k8s:
    name: "{{ item.name }}"
    api_version: v1
    kind: Namespace
    state: present
  loop: "{{ namespaces }}"
  tags: namespaces

- name: Deploy ConfigMap
  kubernetes.core.k8s:
    state: present
    template: "{{ role_path }}/templates/configmap.yml.j2"
  loop: "{{ configmaps }}"
  tags:
    - configmap

- name: Deploy Secret
  kubernetes.core.k8s:
    state: present
    template: "{{ role_path }}/templates/secrets.yml.j2"
  loop: "{{ secrets }}"
  tags:
    - secret

- name: Deploy Service
  kubernetes.core.k8s:
    state: present
    template: "{{ role_path }}/templates/service.yml.j2"
  loop: "{{ services }}"
  tags:
    - service

- name: Deploy Deployment
  kubernetes.core.k8s:
    state: present
    template: "{{ role_path }}/templates/deployment.yml.j2"
  loop: "{{ deployments }}"
  tags:
    - deployment
